---
title: '典型电路-存储器'
date: Mon, 11 Jan 2021 02:38:47 +0000
draft: false
tags: ['设计资料/文档']
---

存储器类别
-----

*   随机存储器
    *   静态SRAM
        *   ZBT SRAM
        *   DDR SRAM
        *   QDR SRAM
    *   动态DRAM
        *   DDR SDRAM
        *   DDR2 SDRAM
        *   SDRAM
        *   DDR3 SDRAM
*   只读存储器
    *   EEPROM
    *   FLASH

SDRAM
-----

SDRAM：Synchronous Dynamic Random Access Memory，即同步动态随机存取存储器。

*   同步: 指其时钟频率与CPU前端总线的系统时钟频率相同, 并且内部命令 的发送 和数据的传输都以它为基准。
*   动态: 指存储数组需要不断的刷新来保证数据不丢失。
*   随机: 指数据不是线性依次存储, 而是自由指定地址进行数据的读写。
*   SDRAM在一个时钟周期内只能读/写一次，只在时钟上升期读/写数据，当同时需要读取和写入时，就得等待其中一个动作完成之后才能继续进行下一个动作。

引脚功能描述参考DDR，另SDRAM对应的VDD和VDDQ电源电压为3.3V

#### 参数

*   工作电压：3.3V LVTTL（ Low Voltage TTL：Transistor-Transistor Logic低电压晶体管逻辑）
*   时钟频率：66MHZ、 100MHZ、133MHZ
*   数据传输率：66Mbps、 100Mbps、 133Mbps

#### 布局要求

uSDRAM需要与控制器器之间进行频繁的数据交换，摆放时尽量靠近主芯片摆放。数据位端靠近控制器放置。

u一般要对SDRAM的时钟、数据、地址及控制信号在源端串联33欧姆或47欧姆的电阻匹配，消除反射。匹配电阻Rs靠近控制器放置。

多片互连时，不管同层平铺还是正反贴摆放，均采用“树形”拓补结构

![](https://a1024.synology.me:222/images/blog2023/SDRAMtuopu.png)

#### 布线要求

阻抗：单端50欧姆

等长匹配：

*   所有数据线误差控制在±50mil以内；无同层要求。
*   所有的时钟、地址、命令、控制线内部控制在±100mil以内。
*   时钟与数据线的误差控制在1000 mil以内。

![SDRAM.png](https://a1024.synology.me:222/images/blog2023/SDRAM.png)

DDR
---

*   时钟频率：100/133/166/200 MHz
*   传输速率：200/266/333/400 Mbps
*   输入输出宽度：x4/x8/x16/x32
*   电源电压：2.5V

严格的说DDR应该叫DDR SDRAM，人们习惯称为DDR。DDR SDRAM是Double Data Rate SDRAM的缩写，是双倍速率同步动态随机存储器的意思。

SDRAM在一个时钟周期内只传输一次数据，它是在时钟的上升期进行数据传输；而DDR则是一个时钟周期内传输两次次数据，它能够在时钟的上升期和下降期各传输一次数据，因此称为双倍速率同步动态随机存储器。

DDR的时钟线CLK 、CLK#为差分线，CLK#与正常CLK时钟相位相反，形成差分时钟信号。而数据的传输在CLK与CLK#的交叉点进行，可见在CLK的上升与下降沿（此时正好是CLK#的上升沿）都有数据被触发，从而实现DDR。

[Micron Double Data Rate (DDR) SDRAM](https://media-www.micron.com/-/media/client/global/documents/products/data-sheet/dram/ddr1/512mb_ddr.pdf)

### 引脚功能描述

![DDRPIN.png](https://a1024.synology.me:222/images/blog2023/DDRPIN.png)

*   CK，CK#：全局时钟输入，DDR的命令信号（ACTIVE、READ、WRITE、PRECHARGE、AUTORECHARGE等），地址信号都是以CK/CK#为时序参考的
*   CKE：时钟使能信号输入
*   CS#：片选信号输入，低电平有效
*   CAS#，RAS#，WE#：命令信号输入，分别为列选择、行选择与写使能信号，低电平有效。这三个信号CS#一起组成了DDR的命令信号
*   LDM，UDM：数据mask信号输入，写数据时，当DM为高电平时对应的写入数据无效。LDM与UDM分别对应与数据信号的低8位与高8位
*   A<0~12>：地址信号输入
*   BA0，BA1：BANK选择信号输入，用以确定当前的命令操作对哪个BANK有效。
*   DQ<0~15>：数据信号输入/输出
*   LDQS，UDQS：数据锁存信号输入/输出
*   NC：空引脚
*   DNU：不使用引脚
*   VDDQ：DQ电源电压（2.5V）
*   VSSQ：DQ地
*   VDD：器件电源电压（2.5V）
*   VSS：器件地
*   VREF：参考电压，内部进行高低电平判决的参考电压。

**DDR2**
--------

*   时钟频率：200/266/333/400 MHz
*   传输速率：400/533/667/800 Mbps
*   输入输出宽度：x4/x8/x16
*   电源电压：1.8V

数字信号组DQ，DQS/ DQS #，DM，其中每个字节又是内部的一个通道Lane组，如DQ0~DQ7，DQS0/DQS0#，DM0为一个信号组。

 命令信号组：,BA

 控制信号组：，CKE，ODT

 Feedback  clocks: sync\_clk

一般来说，DQ，DQS和时钟信号线选择GND作为参考平面，因为GND比较稳定，不易受到干扰。地址/命令/控制信号线可选择VDD作为参考平面，因为这些信号线本身就含有噪声。

对于双向I/O信号来说，例如DQ，在信号的两端，需要放置电阻，当布局空间受限的情况下，串行端接电阻Rs放置在走线的中间，用来抑制发射。

对于单向的信号来说，例如地址线，控制线，串行端接电阻放置在走线中 间或者是信号的发送端，推荐放置在信号的发送端。

一个数据组Data、 Data strobe 、 Data mask之间的误差为±25mil

 Data strobe之间可以有500mil的误差

 数据与时钟CK之间没有严格的等长要求

这里的电源完整性指的是在最大的信号切换情况下，其电源的容差性。当未符合此容差要求时，将会导致很多的问题，比如加大时钟抖动、数据抖动和串扰。

在 DDR的设计上有三类电源，它们是VDD、VTT和Vref。

Vref：参考电压，承载着比较小的电流，走线20mil左右，与其它线间距15－20mil。且通过一两个去耦电容就可以达到目标阻抗的要求。由于Vref相当重要，所以去耦电容的摆放尽量靠近器件的管脚。

VTT：用于端接地址、命令、 控制信号线，并不短接时钟线，具有很大的瞬间电流，此电流可以算出来，最终可以通过增加去耦电容的数量来实现目标阻抗匹配。走线的时候需要大面积的铺铜，最好在表层。

### Layout要求

#### 布局

地址信号与控制信号是单向信号，且一般都是点到多点的拓扑结构。，要求串联电阻靠近存储器控制器端，多个DDR间使用T型拓扑，拓扑的各分支尽量短且臂长相等，并联电阻放在接收端的第一个TDDR节点上。

串、并联电阻的位置以器件手册推荐、客户要求或者仿真结果为准，在不能判定时一般串阻靠近主芯片放置，并联电阻靠近DDRII放置，对于菊花链结构的一般放置在最末端对于远端分支结构的放置在第一个远端分又点上，分又点到并联电阻的距离尽量短，以减少STUB的长度。

差分时钟信号一般都是点到点拓扑，有时候也有使用点到多点的结构。终端匹配电阻要求尽量靠近接收端，或者放置在接收端之后。对点到多点的结构，则使用如地址线的端接拓扑。

DataMask信号是点到点单向拓扑结构，要求串联电阻放在控制器端并联电阻放在DDR端。

Vref电源（0.9V）的电容必须紧靠DDRII\\CPU管脚。

1.8V电源的电容必须紧靠DDRII\\CPU管脚，有的客户将DDRII和CPU的电源分开，建议合并。

一带一的DDRII：注意按照网络鼠线显示将DDR放在主芯片的旁边，留出绕等长的空间。  
一带二的DDRII：一般采用对称布局，注意地址线的走线和排阻布放位置。  
一带四的DDRII：一般采用两两正反对贴，如果将DDRII放置在同一面，导致远端分支过长。  
一带八的DDRII：必须采用两两正反对贴，如果将DDRII放置在同一面，使远端分支的走线很困难。

#### 布线

*   推荐DDR2接口的所有信号走线都布置在有良好地参考平面的内层信号层上，以保证阻抗的连续以及最短的回流路径。如果不能完全满足要求，优先将时钟与数据信号布置在良好地参考平面的信号层，其他信号可以布置在以电源为参考平面的信号层上。注意参考平面的完整性与连续性；
*   同一个字节的DQ/DQSN（P）/DM（共11根信号线）要求一起走线（中间不能夹杂任何其它信号线），并要求DQS与其他信号线的间距满足3W原则；本组的信号与其他组的信号间距要求在20mi1以上；打过孔的数量一致，并走在同一层。同一组的信号等长要求在10mi1（+、-5mi1），不同组的等长要求在200mil，尽量做到等长，优先考虑同一组等长。
*   布线时，最好少换层，以避免过孔效应。
*   布线时，不允许有跨分割的信号线存在，特别是相邻的电源层平面
*   布线时，所有信号线都尽量保证3W的间距。
*   引入到内层的高速信号线是否在表层引出小于1mm打过孔。
*   DDR2走线与参考平面边界的距离必须大于40mil。
*   在换层的地方增加回流地过孔。
*   对于单端线控制阻抗最好在50-—-60ohm之间（有的器件厂商会要求55-—-65ohm之间，最好60ohm），对于差分信号线，阻抗控制在100-—-120ohm之间。重点考虑阻抗的连续性，拒绝叠层时内外层阻抗相差2ohm以上，最好能控制在0.5ohm以内
*   一般情况下地址采用远端分支，可以根据器件手册要求或者仿真更改为菊花链
*   对于DIMM内存条，一般DDR2的信号线被分成四组，分别为：
    *   lane组：DQS/DQS#N、DMN、 DQN\[7:0\]
    *   数据组：DQS/DQS#\[8:0\]、DM\[8:0\]、DQ\[63:0\]、MECC\[7:0\]
    *   地址组：BA\[2:0\]、A\[15:0\]、RAS#、CAS#、WE#
    *   命令组：CS\[3:0\]、CKE\[3:0\]、ODT\[3:0\]
    *   时钟组：CK/CK#L5:0\]
*   等长要求：一般lane数据组控制在10mi1以内，不同1ane组在200mi1以内，地址、命令、时钟组控制在50mi1以内，差分对内控制在10mi1以内。
*   地址组、命令组、时钟组合数据组的等长范围最好控制在1000mil（+、-500mil）以内。
*   如果有串阻，串阻之前等长，串阻之后等长。（有20%的DDR2设计需要这么做，只是建议）
*   时钟与数据等长范围控制在1000mil以内。
*   Vref的走线宽度必须大于20mil，Vref上纹波过大，有可能造成读写操作出错。Vref与同层其它信号线间距最好达到20mi1以上，Vref必须跟随VDDQ电源变化，可以通过分压电阻产生，分压电阻的精度要求为1%。
*   DQGATE组：DQGATE组分为低16位和高16位。前者由DQGATEO，端接电阻，DQGATE1组成；后者由由DQGATE2，端接电阻，DQGATE3组成。依下列公式分别计算DQGATE网络低、高16位的连线长度，然后按照下图所示的拓扑结构进行布线。
    *   DQGATE L = DDRCLKOUTP + CDDRDQSOP + DDRDQSIP）/2
    *   DQGATE H = DDRCLKOUTP + (DDRDQS2P + DDRDQS3P）/2

DDR3
----

*   时钟频率：400/533/667/800 MHz
*   传输速率：800/1066/1333/1600 Mbps
*   输入输出宽度：x4/x8/x16
*   电源电压：1.5V

单线阻抗：控制在40-60欧姆之间   （ 默认50欧姆为标准）

差分阻抗：100欧姆

VTT需要至少150mil线宽处理， 最好能够表底层铺铜

REF至少20mil线宽处理

DDR4
----

时钟频率：200/266/333/400 MHz

传输速率：400/533/667/800 Mbps

输入输出宽度：x4/x8/x16

电源电压：1.8V